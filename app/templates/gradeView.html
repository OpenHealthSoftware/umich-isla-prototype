{% extends "base.html" %}
{% block css %}
<link rel="stylesheet" href="{{url_for('static', filename='css/carousel.css')}}"/>
<link rel="stylesheet" href="{{url_for('static', filename='css/split.css')}}"/>
<link rel="stylesheet" href="{{url_for('static', filename='css/index.css')}}"/>
{% endblock %}
{% block headnav %}{% endblock %}
{% block content %}
	
	

	
	
	<div id="wrapMenuBar">
		<div id="dropMenu1" class="wrap-menu  btn-seperator-right">
			<button id="menuBtn" class="menu-btn">Menu</button>
			<div id="menuDropdownCont" class="wrap-drop-down">
				<div id="menuDropdown" class="drop-down">
					<a href="{{ url_for('main.main_route', gallery='patient') }}" class="patient-shade-1">Patients</a>
					<a href="{{ url_for('main.main_route', gallery='normal') }}" class="normal-shade-1">Normals</a>
					<a href="{{ url_for('uploads.main_route') }}">Upload</a>
					<a href="{{ url_for('docs.main_route') }}">Help / Info</a>
				</div>
			</div>
		</div> <!-- END #menuBar -->

		<div id="toolbar" class="wrap-menu">
			<div class="toolbarEl btn-seperator-right">
				<button id="showNormalBtn" class="toolbarEl">Show normal</button>
				<span class="tooltip">Hold down to show the normal/control image</span>
			</div><!--
			--><div class="toolbarEl btn-seperator-right">
				<button id="toggleGridsBtn" class="toolbarEl" onclick="toggleGrids()">Hide grid</button>
				<span class="tooltip">Click to hide or show the grid</span>
			</div><!--
			--><div class="toolbarEl btn-seperator-right">
				<button id="export" class="toolbarEl">Export grade</button>
				<span class="tooltip">Save the grade data to your computer</span>
			</div>
		</div><!-- END #toolbar -->

	</div><!-- END #wrapMenuBar -->

	<div id="wrapMainScreen">
		<div id="leftScreen" class="split split-horizontal" >
			<div id="fullView">
				{% if not img['imgId'] %}
						<a href="{{ url_for('main.main_route', gallery='patient') }}" class="patient-shade-1 btn-large">Click to Grade an Existing Image</a>
						<a href="{{ url_for('uploads.main_route') }}" class="btn-large">Click to Upload a New Control or Patient Image</a>
				{%  else %}

				{% set faSrc = url_for('static', filename='images/uploads/' + img['imgId'] + '.' + img['format']) %}
				{% set gridSrc = url_for('static', filename='images/uploads/grid_' + img['imgId'] + '.' + img['format']) %}
				<div style="position:relative;">
					<img  id="mainFA_image" class="pic" src="{{faSrc}}">
					<img src="{{gridSrc}}" id="grid" class="pic overlay grid" usemap="#map" style="display:block">
					<canvas id="mainFA_canvas" class="traceCanvas" width="0" height="0"></canvas>
				</div>
				<div id="mainNormal">
					<img id="normalImg" class="pic" src="">
					<!--<img id="normalGrid" class="pic overlay grid" src="" >-->
					<canvas id="norm_canvas" class="traceCanvas" width="0" height="0"></canvas>
					<h2 style="position:absolute;color:white;top:10px;">Normal Image</h2>										
				</div>
				{% endif %}
			</div>
		</div>

		{% if not img['imgId'] %}
		{% set lock = 'lock' %}
		{% endif %}
		<div id="rightScreen" class="split split-horizontal {{lock}}" >
			<div id="wrapGrading">
				
				<div id="wrapCellControl" class="margin-bottom-small">
					
					<div class="maintain-ratio">
						<div id="cellPreview" class="cellControlModule">
							<canvas id="cellViewCanvas" class="cellCanvas" width="0" height="0"></canvas>
						</div>
					</div><!--
					--><div id="wrapCellTools">
						<div id="cellTools" class="cellControlModule">
							<div id="cellNavigator" class="margin-bottom-small">
								<button id="prevCell" class="half-width button-row-el btn-seperator-right" onclick="nextCell(-1)">Prev Cell</button>						
								<button id="nextCell" class="half-width button-row-el" onclick="nextCell()">Next Cell</button>
							</div>
							<div id="wrapContrastControl" class="margin-bottom-small">
								<div id="contrastSliderLabel">
									<p>Contrast: <span id="contrastOutputPercent">100</span>%</p>
								</div>
								<div id="wrapContrastSlider">
									<div id="contrastSlider" class=""></div><div id="cSlidFix"></div>
								</div>
							</div>
							<div id="wrapCellStats">
								<p id="cellNumberP">Cell: <span id="cellNumber"></span></p>
								<p id="gradeStatus"></p>
								<p id="gradeData"></p>
								<p id="notif"></p>
							</div>
						</div><!-- END #cellTools -->
					</div>

				</div><!-- END #wrapCellControl -->

				<div id="wrapGradeOptions" class="margin-bottom-small">
					<div id="primaryGrade" class="firstClassOptions margin-bottom-small">
						<form id="gradeForm" class="submit-input-container">
							<input type="radio" name="grade" value="perfused" id="gradePerf">
							<input type="radio" name="grade" value="hypo-perfused" id="gradeHypoPerf">
							<input type="radio" name="grade" value="non-perfused" id="gradeNonPerf">
							<input type="radio" name="grade" value="NA" id="gradeNA">
							<label for="gradePerf" class="button button-row-el fourth-width btn-seperator-right">Perfused</label>
							<label for="gradeHypoPerf" class="button button-row-el fourth-width btn-seperator-right">Hypoperfused</label>
							<label for="gradeNonPerf" class="button button-row-el fourth-width btn-seperator-right">Non-Perfused</label>
							<label for="gradeNA" class="button button-row-el fourth-width">NA / Ungradeable</label>
						</form>
					</div>

					<div id="secondaryGrades">
						<div id="wrapAssociatedOptions" class="secondClassOptions">
							<div id="associatedFeatures" class="submit-input-container">
								{% for a in associatedFeatures %}
								<div class="option-box-element">
									<input class="optional-input" type="checkbox" id="option_{{a.optionId}}" name="associatedFeature" value="{{a.name}}">
									<label for="option_{{a.optionId}}" class="checkbox"><div class="check-select"></div></label>
									<label for="option_{{a.optionId}}" class="options-label">{{a.name}}</label>
									<div class="selectExampleBtn" onclick="toggleExample(this, '{{a.name}}')"><p>?</p></div>
								</div>
								{% endfor %}
							</div>
						</div>
						<div id="definitionsToolbar">
							
						</div>
					</div> <!-- END #secondaryGrades -->

				</div><!--END #wrapGradeOptions -->

				<button id="submitGrade" onclick="submitGrade()">Submit</button>
			</div> <!-- END #wrapGrading -->

			<div class="seperator-vertical"></div>

			<div id="wrapComparisons">
				<div id="wrapNormalComparisons" class="half-height">
					<div class="maintain-ratio-full" style="background-color:#1d1d1d">
						<div id="normalCell" class="cellControlModule">			
								<canvas id="normalCellViewCanvas" class="cellCanvas" width="0" height="0"></canvas>
						</div>
						<div onclick="getNormal(-1)" class="select-image select-image-prev"></div>												
						<div onclick="getNormal(1)" class="select-image select-image-next"></div>												
					</div>
					<h2>Normal/Control Cell</h2>
				</div>

				<div id="wrapAssociatedFeatureExamples" class="half-height">
					<div class="maintain-ratio-full">
						<div id="associatedFeatureExample" class="cellControlModule asscFeatureEl">
							<img id="associatedFeaturePreview" src=""/>
							<div onclick="getExample(-1)" class="select-image select-image-prev"></div>							
							<div onclick="getExample(1)" class="select-image select-image-next"></div>							
						</div> <!-- END #associatedFeatureExample -->
					</div>
					<div id="asscFtNameExampleInfo" class="asscFeatureEl">
						<p id="asscFtDesc"></p>
					</div>
				</div>
			</div> <!-- END #wrapComparsions -->
			
		</div><!-- END #rightScreen -->

		<div id="wrapSideBar"></div><!-- END #wrapSideBar -->
	</div><!-- END #wrapMainScreen -->

	<div id="wrapStatusBar"></div><!-- END #wrapStatusBar -->
	
	<div id="viewFrameCont" class="popup">
		<div id="exitFrame" class="exitFrame"><button id="closeBtn">Close</button></div>
		<div id="viewFrame" class="viewFrame"></div>
	</div>

	<div id="continueFrameCont" class="popup">
		<div id="exitContinueFrame" class="exitFrame"><button>Close</button></div>
		<div id="viewContinueFrame" class="viewFrame">
			<br/><br/>
			You have graded all of the cells. Choose an option to continue.<br/>
			<button id="export">Export grade to file</button>
			<button onclick="router('patient')" class="patient-shade-1">Grade another image</button>
		</div>
	</div>

	{% if gradeSessions and false %}
	<div id="form-popup" class="popup">
		<div id="wrap-form">
		<h3>It looks like you have graded this image before. You can select from some of your saved data or start a new session.</h3>
		<form id="loadGradeForm">
			{% for g in gradeSessions %}
			<input type="radio" name="gradeSession" value={{g['gradeId']}} id="{{g['gradeId']}}">
			<label for="{{g['gradeId']}}">Time: {{g['timestamp']}} UTC  |  Cells Graded: {{g['cellsGraded']}}  |  Session: {{g['sessionId']}}</label><br/>
			{% endfor %}
			<input type="radio" name="gradeSession" value="-1" id="newOption">
			<label for="newOption">New grading session</label>
		</form>
		<button id="loadGradeBtn" onclick="loadGrades()">Select</button>
		</div>
	</div>
	{% endif %}

	<map name="map" id="gridMap">
	{# {% for i in coords %}
		<area id="cell_{{loop.index}}" shape="poly" coords="{{i}}" >
	{% endfor %} #}
	</map>


	<script>
		var GRADE_ID = -1;
	</script>


{% endblock %}


{% block js %}
<script src="{{url_for('static', filename='js/carousel.js')}}"></script>
<script src="{{url_for('static', filename='js/split.min.js')}}"></script>
<script src="{{url_for('static', filename='js/test.js')}}"></script>
<!-- <script src="{{url_for('static', filename='js/uploads.js')}}"></script> -->
<script>

$('document').ready()
{
	
	var gutterSize = 7;

	var leftRightScreenSplit = Split(['#leftScreen', '#rightScreen'], { 
		sizes : [45,55], 
		gutterSize: gutterSize,
		onDragEnd : function(){
			remap();
			if (hasCellBeenDrawn == true)
				drawCellManager(currentCell);
		},
		
	});

	
}
</script>

{% endblock %}
